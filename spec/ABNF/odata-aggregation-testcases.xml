<?xml version="1.0" encoding="UTF-8"?>
<TestSuite MaxUncoveredRules="80" xmlns="http://docs.oasis-open.org/odata/ns/testcases">
  <DisableTrace Rule="odataIdentifier" />
  <DisableTrace Rule="identifierLeadingCharacter" />
  <DisableTrace Rule="identifierCharacter" />
  <DisableTrace Rule="ALPHA" />
  <DisableTrace Rule="DIGIT" />

  <!-- TODO: remove unnecessary matches, be careful when removing constraints -->
  <Constraint Rule="action">
    <Match>ActionName</Match>
    <Match>Rejection</Match>
  </Constraint>
  <Constraint Rule="actionImport">
    <Match>Activation</Match>
  </Constraint>
  <Constraint Rule="complexColProperty">
    <Match>Addresses</Match>
  </Constraint>
  <Constraint Rule="complexColFunction">
    <Match>MostPopularAddresses</Match>
  </Constraint>
  <Constraint Rule="complexColFunctionImport">
    <Match>TheMostPopularAddresses</Match>
  </Constraint>
  <Constraint Rule="complexFunction">
    <Match>MostPopularAddress</Match>
  </Constraint>
  <Constraint Rule="complexFunctionImport">
    <Match>TheMostPopularAddress</Match>
  </Constraint>
  <Constraint Rule="complexProperty">
    <Match>Address</Match>
  </Constraint>
  <Constraint Rule="complexTypeName">
    <Match>Address</Match>
    <Match>AddressWithLocation</Match>
  </Constraint>
  <Constraint Rule="customName">
    <Match>!deltatoken</Match>
    <Match>!special</Match>
    <Match>search</Match>
  </Constraint>
  <Constraint Rule="entityColFunction">
    <Match>AllOrders</Match>
    <Match>ProductsByColor</Match>
  </Constraint>
  <Constraint Rule="entityColFunctionImport">
    <Match>AllProductsByColor</Match>
    <Match>AllProductsByCategoryId</Match>
  </Constraint>
  <Constraint Rule="entityColNavigationProperty">
    <Match>DirectReports</Match>
    <Match>Items</Match>
    <Match>Orders</Match>
    <Match>Products</Match>
    <Match>Sales</Match>
  </Constraint>
  <Constraint Rule="entityContainer">
    <Match>Container</Match>
  </Constraint>
  <Constraint Rule="entityColFunction">
  </Constraint>
  <Constraint Rule="entityColFunctionImport">
    <Match>ProductsByCategoryId</Match>
    <Match>ProductsByColor</Match>
    <Match>ProductsByComplex</Match>
    <Match>ProductsByCustomerRef</Match>
  </Constraint>
  <Constraint Rule="entityFunction">
    <Match>BestProduct</Match>
    <Match>MostExpensive</Match>
  </Constraint>
  <Constraint Rule="entityFunctionImport">
    <Match>TheBestProduct</Match>
  </Constraint>
  <Constraint Rule="entityNavigationProperty">
    <Match>Category</Match>
    <Match>Continent</Match>
    <Match>Country</Match>
    <Match>CountrySet</Match>
    <Match>Currency</Match>
    <Match>Customer</Match>
    <Match>CustomerSet</Match>
    <Match>Product</Match>
    <Match>ProductGroup</Match>
    <Match>Supplier</Match>
    <Match>Time</Match>
  </Constraint>
  <Constraint Rule="entitySetName">
    <Match>Categories</Match>
    <Match>Customers</Match>
    <Match>Employees</Match>
    <Match>LeaveRequests</Match>
    <Match>Orders</Match>
    <Match>OrderItems</Match>
    <Match>Products</Match>
    <Match>Sales</Match>
    <Match>SalesOrganizations</Match>
    <Match>Suppliers</Match>
  </Constraint>
  <Constraint Rule="entityTypeName">
    <Match>Customer</Match>
    <Match>Manager</Match>
    <Match>BestSellingProduct</Match>
    <Match>PreferredSupplier</Match>
    <Match>VipCustomer</Match>
  </Constraint>
  <Constraint Rule="enumerationMember">
    <Match>Solid</Match>
    <Match>Yellow</Match>
  </Constraint>
  <Constraint Rule="enumerationTypeName">
    <Match>NameKind</Match>
    <Match>Pattern</Match>
  </Constraint>
  <Constraint Rule="keyPropertyAlias">
    <Match>KeyAlias</Match>
  </Constraint>
  <Constraint Rule="lambdaVariableExpr">
    <Match>lambda</Match>
  </Constraint>
  <Constraint Rule="namedEntity">
    <Match>BestProductEverCreated</Match>
    <Match>NamedEntity</Match>
  </Constraint>
  <Constraint Rule="namespacePart">
    <Match>Model</Match>
    <Match>Namespace</Match>
    <Match>odata</Match>
    <Match>SaM</Match>
    <Match>Sales</Match>
  </Constraint>
  <Constraint Rule="primitiveColFunction">
    <Match>MostPopularNames</Match>
  </Constraint>
  <Constraint Rule="primitiveColFunctionImport">
    <Match>TheMostPopularNames</Match>
  </Constraint>
  <Constraint Rule="primitiveColProperty">
    <Match>EmailAddresses</Match>
    <Match>Names</Match>
    <Match>Sizes</Match>
  </Constraint>
  <Constraint Rule="primitiveFunction">
    <Match>Available</Match>
    <Match>MostPopularName</Match>
    <Match>PhoneticallySimilar</Match>
  </Constraint>
  <Constraint Rule="primitiveFunctionImport">
    <Match>TheMostPopularName</Match>
  </Constraint>
  <Constraint Rule="primitiveKeyProperty">
    <Match>Code</Match>
    <Match>Date</Match>
    <Match>ID</Match>
    <Match>ItemID</Match>
    <Match>OrderID</Match>
    <Match>Size</Match>
  </Constraint>
  <Constraint Rule="primitiveNonKeyProperty">
    <Match>AccountRepresentative</Match>
    <Match>Amount</Match>
    <Match>BirthDate</Match>
    <Match>City</Match>
    <Match>CompanyName</Match>
    <Match>ContactName</Match>
    <Match>Completed</Match>
    <Match>Cost</Match>
    <Match>CountryCode</Match>
    <Match>eyeColor</Match>
    <Match>FirstName</Match>
    <Match>LastName</Match>
    <Match>LifeTime</Match>
    <Match>Line</Match>
    <Match>Location</Match>
    <Match>Month</Match>
    <Match>Name</Match>
    <Match>Population</Match>
    <Match>Price</Match>
    <Match>Quantity</Match>
    <Match>Rating</Match>
    <Match>ReleaseDate</Match>
    <Match>Revenue</Match>
    <Match>SalesArea</Match>
    <Match>Shipped</Match>
    <Match>Spokesperson</Match>
    <Match>Status</Match>
    <Match>Street</Match>
    <Match>style</Match>
    <Match>SumAmount</Match>
    <Match>TaxRate</Match>
    <Match>Title</Match>
  </Constraint>
  <Constraint Rule="streamProperty">
  </Constraint>

  <TestCase Name="Aggregation - basic" Rule="queryOptions">
    <Input>$apply=aggregate(Amount)</Input>
  </TestCase>
  <TestCase Name="Aggregation - alias" Rule="queryOptions">
    <!-- TODO: parens around expression should be unnecessary -->
    <Input>$apply=aggregate(Amount as TotalAmount)</Input>
  </TestCase>
  <TestCase Name="Aggregation - expression" Rule="queryOptions">
    <Input>$apply=aggregate(Amount mul Product/TaxRate as Tax)</Input>
  </TestCase>
  <TestCase Name="Aggregation - expression after path" Rule="queryOptions">
    <Input>$apply=aggregate(Sales(Amount mul Product/TaxRate as Tax))</Input>
  </TestCase>
  <TestCase Name="Aggregation - aggregation function" Rule="queryOptions">
    <Input>$apply=aggregate(Amount with max as MaxAmount)</Input>
  </TestCase>
  <TestCase Name="Aggregation - aggregation function and alias" Rule="queryOptions">
    <Input>$apply=aggregate(Product with countdistinct as DistinctProducts)</Input>
  </TestCase>
  <TestCase Name="Aggregation - aggregation function" Rule="queryOptions">
    <Input>$apply=aggregate(Amount as DailyAverage from Time with average)</Input>
  </TestCase>
  <TestCase Name="Aggregation - $count" Rule="queryOptions">
    <Input>$apply=aggregate($count as SalesCount)</Input>
  </TestCase>
  <TestCase Name="Aggregation - $count does not allow with" Rule="queryOptions" FailAt="24">
    <Input>$apply=aggregate($count with sum as SalesCount)</Input>
  </TestCase>
  <TestCase Name="Aggregation - topcount" Rule="queryOptions">
    <Input>$apply=topcount(2,Amount)</Input>
  </TestCase>
  <TestCase Name="Aggregation - topsum" Rule="queryOptions">
    <Input>$apply=topsum(15,Amount)</Input>
  </TestCase>
  <TestCase Name="Aggregation - toppercent" Rule="queryOptions">
    <Input>$apply=toppercent(50,Amount)</Input>
  </TestCase>
  <TestCase Name="Aggregation - bottomcount" Rule="queryOptions">
    <Input>$apply=bottomcount(2,Amount)</Input>
  </TestCase>
  <TestCase Name="Aggregation - bottomsum" Rule="queryOptions">
    <Input>$apply=bottomsum(15,Amount)</Input>
  </TestCase>
  <TestCase Name="Aggregation - bottompercent" Rule="queryOptions">
    <Input>$apply=bottompercent(50,Amount)</Input>
  </TestCase>
  <TestCase Name="Aggregation - identity" Rule="queryOptions">
    <Input>$apply=identity</Input>
  </TestCase>
  <TestCase Name="Aggregation - concat" Rule="queryOptions">
    <Input>$apply=concat(topcount(2,Amount),bottomcount(2,Amount))</Input>
  </TestCase>
  <TestCase Name="Aggregation - groupby" Rule="queryOptions">
    <Input>$apply=groupby((Customer/Country,Product/Name),aggregate(Amount))</Input>
  </TestCase>
  <TestCase Name="Aggregation - groupby distinct" Rule="queryOptions">
    <Input>$apply=groupby((Product/Name,Amount),aggregate())</Input>
  </TestCase>
  <TestCase Name="Aggregation - groupby rollup" Rule="queryOptions">
    <Input>$apply=groupby((rollup(Customer/Country,Customer/Name),rollup(Product/ProductGroup/Name,Product/Name),Currency/Code),aggregate(Amount))</Input>
  </TestCase>
  <TestCase Name="Aggregation - filter" Rule="queryOptions">
    <Input>$apply=filter(Amount gt 3)</Input>
  </TestCase>
  <TestCase Name="Aggregation - expand" Rule="queryOptions">
    <Input>$apply=expand(Sales,Amount gt 3)</Input>
  </TestCase>
  <TestCase Name="Aggregation - on entity container" Rule="odataRelativeUri">
    <Input>Model.Container?$apply=groupby((Products/Name,Time/Date),aggregate(Sales/Amount))</Input>
  </TestCase>
  <TestCase Name="Aggregation - hierarchy functions - isroot" Rule="odataRelativeUri">
    <Input>SalesOrganizations?$filter=isroot(SaM.SalesOrgHierarchy)</Input>
  </TestCase>
  <TestCase Name="Aggregation - hierarchy functions - isdescendant" Rule="odataRelativeUri">
    <Input>SalesOrganizations?$filter=isdescendant(SaM.SalesOrgHierarchy,'EMEA')</Input>
  </TestCase>
  <TestCase Name="Aggregation - hierarchy functions - isdescendant" Rule="odataRelativeUri">
    <Input>SalesOrganizations?$filter=isdescendant(SaM.SalesOrgHierarchy,'EMEA',1)</Input>
  </TestCase>
  <TestCase Name="Aggregation - hierarchy functions - isancestor" Rule="odataRelativeUri">
    <Input>SalesOrganizations?$filter=isancestor(SaM.SalesOrgHierarchy,'EMEA')</Input>
  </TestCase>
  <TestCase Name="Aggregation - hierarchy functions - isancestor" Rule="odataRelativeUri">
    <Input>SalesOrganizations?$filter=isancestor(SaM.SalesOrgHierarchy,'EMEA',1)</Input>
  </TestCase>
  <TestCase Name="Aggregation - hierarchy functions - issibling" Rule="odataRelativeUri">
    <Input>SalesOrganizations?$filter=issibling(SaM.SalesOrgHierarchy,'EMEA')</Input>
  </TestCase>
  <TestCase Name="Aggregation - hierarchy functions - isleaf" Rule="odataRelativeUri">
    <Input>SalesOrganizations?$filter=isleaf(SaM.SalesOrgHierarchy)</Input>
  </TestCase>
  <TestCase Name="Aggregation - Examples" Rule="odataRelativeUri">
    <Input>Customers?$apply=groupby((Name),aggregate())</Input>
  </TestCase>
  <TestCase Name="Aggregation - Examples" Rule="queryOptions">
    <Input>$apply=groupby((Customer/Name),aggregate())</Input>
  </TestCase>
  <TestCase Name="Aggregation - Examples" Rule="queryOptions">
    <Input>$apply=groupby((Customer/Name,Customer/ID),aggregate())</Input>
  </TestCase>
  <TestCase Name="Aggregation - Examples" Rule="queryOptions">
    <Input>$apply=groupby((Customer),aggregate())</Input>
  </TestCase>
  <TestCase Name="Aggregation - Examples" Rule="queryOptions">
    <Input>$apply=groupby((Customer/Name,Customer/ID,Product/Name),aggregate())</Input>
  </TestCase>
  <TestCase Name="Aggregation - Examples" Rule="queryOptions">
    <Input>$apply=groupby((Name),aggregate(Sales/Amount))</Input>
  </TestCase>
  <TestCase Name="Aggregation - Examples" Rule="queryOptions">
    <Input>$apply=groupby((Name),aggregate(Sales(Amount as TotalAmount)))</Input>
  </TestCase>
  <TestCase Name="Aggregation - Examples" Rule="queryOptions">
    <Input>$apply=groupby((Name),aggregate(Sales(Revenue sub Cost as Profit)))</Input>
  </TestCase>
  <TestCase Name="Aggregation - Examples" Rule="queryOptions">
    <Input>$apply=groupby((Name),aggregate(Revenue sub Cost as Profit))</Input>
  </TestCase>
  <TestCase Name="Aggregation - Examples" Rule="queryOptions">
    <Input>$apply=groupby((Name,Sales/Currency/Code),aggregate(Sales/Amount))</Input>
  </TestCase>
  <TestCase Name="Aggregation - Examples" Rule="queryOptions">
    <Input>$apply=groupby((Country,Sales/Product/Name),aggregate())</Input>
  </TestCase>
  <TestCase Name="Aggregation - Examples" Rule="queryOptions">
    <Input>$apply=groupby((Customer/Country),aggregate(Amount with sum as TotalAmount))</Input>
  </TestCase>
  <TestCase Name="Aggregation - Examples" Rule="queryOptions">
    <Input>$apply=groupby((Customer/Country),aggregate(Amount with min as MinAmount))</Input>
  </TestCase>
  <TestCase Name="Aggregation - Examples" Rule="queryOptions">
    <Input>$apply=groupby((Customer/Country),aggregate(Amount with max as MaxAmount))</Input>
  </TestCase>
  <TestCase Name="Aggregation - Examples" Rule="queryOptions">
    <Input>$apply=groupby((Customer/Country),aggregate(Amount with average as AverageAmount))</Input>
  </TestCase>
  <TestCase Name="Aggregation - Examples" Rule="queryOptions">
    <Input>$apply=groupby((Name),aggregate(Sales/$count as SalesCount))</Input>
  </TestCase>
  <TestCase Name="Aggregation - Examples" Rule="queryOptions">
    <Input>$apply=groupby((Name),aggregate(Sales($count as SalesCount)))</Input>
  </TestCase>
  <TestCase Name="Aggregation - Examples" Rule="queryOptions">
    <Input>$apply=groupby((Name),aggregate(Sales/$count as SalesCount,Sales(Amount as TotalAmount)))</Input>
  </TestCase>
  <TestCase Name="Aggregation - Examples" Rule="queryOptions">
    <Input>$apply=groupby((Customer/Country),aggregate(Amount with sum as TotalAmount,Amount with average as AvgAmt))</Input>
  </TestCase>
  <TestCase Name="Aggregation - Examples" Rule="queryOptions">
    <Input>$apply=groupby((Name),aggregate(Sales(Amount with sum as TotalAmount),Sales(Amount with average as AvgAmt)))</Input>
  </TestCase>
  <TestCase Name="Aggregation - Examples" Rule="queryOptions">
    <Input>$apply=groupby((Customer/Country,Product/Name),concat(aggregate(Amount),topcount(1,Amount)))</Input>
  </TestCase>
  <TestCase Name="Aggregation - Examples" Rule="queryOptions">
    <Input>$apply=groupby((Product/ID,Product/Name,Time/Month),aggregate(Amount with sum as SumAmount))/groupby((Product/ID,Product/Name),aggregate(SumAmount with average as AverageAmount))</Input>
  </TestCase>
  <TestCase Name="Aggregation - Examples" Rule="queryOptions">
    <Input>$apply=groupby((Product/ID,Product/Name),aggregate(Amount with sum as MonthlyAverage from Time/Month with average))</Input>
  </TestCase>
  <TestCase Name="Aggregation - Examples" Rule="queryOptions">
    <Input>$apply=groupby((rollup($all,Customer/Country,Customer/ID),Currency/Code),aggregate(Amount as AverageAmount from Customer/ID with average from Customer/Country with average))</Input>
  </TestCase>
  <TestCase Name="Aggregation - Examples" Rule="queryOptions">
    <Input>$apply=filter(Amount le 1)/aggregate(Amount)</Input>
  </TestCase>
  <TestCase Name="Aggregation - Examples" Rule="queryOptions">
    <Input>$apply=filter(Amount le 2)/groupby((Product/Name),aggregate(Amount))&amp;$filter=Amount ge 4</Input>
  </TestCase>
  <TestCase Name="Aggregation - Examples" Rule="queryOptions">
    <Input>$apply=groupby((Continent/Name,Country/Name),aggregate(Population))</Input>
  </TestCase>
  <TestCase Name="Aggregation - Examples" Rule="queryOptions">
    <Input>$apply=filter(Population ge 10000000)/groupby((Continent/Name,Country/Name),aggregate(Population))</Input>
  </TestCase>
  <TestCase Name="Aggregation - Examples" Rule="queryOptions">
    <Input>$apply=groupby((Continent/Name,Country/Name),aggregate(Population))/filter(Population ge 10000000)/concat(identity,groupby((Continent/Name),aggregate(Population)))</Input>
  </TestCase>
  <TestCase Name="Aggregation - Examples" Rule="queryOptions">
    <Input>$apply=groupby((Continent/Name,Country/Name),aggregate(Population))/filter(Population ge 10000000)/groupby((rollup(Continent/Name,Country/Name)),aggregate(Population))</Input>
  </TestCase>
  <TestCase Name="Aggregation - Examples" Rule="queryOptions">
    <Input>$apply=groupby((Continent/Name,Country/Name),aggregate(Population))/concat(filter(Population ge 10000000),groupby((Continent/Name),aggregate(Population)))</Input>
  </TestCase>
  <TestCase Name="Aggregation - Examples" Rule="queryOptions">
    <Input>$apply=filter(Status eq 'incomplete')/expand(Items,not Shipped)/groupby((Customer/Country),aggregate(Items/Amount))</Input>
  </TestCase>
</TestSuite>