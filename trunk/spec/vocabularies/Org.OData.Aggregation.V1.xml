<?xml version="1.0" encoding="utf-8"?>
<edmx:Edmx xmlns:edmx="http://docs.oasis-open.org/odata/ns/edmx" Version="4.0">
  <edmx:Reference Url="http://tinyurl.com/Org-OData-Core" />
  <edmx:DataServices>
    <Schema xmlns="http://docs.oasis-open.org/odata/ns/edm" Namespace="Org.OData.Aggregation.V1" Alias="Aggregation">
      <Documentation>
        <Summary>The following annotations allow to describe which data in a given entity
          model can be aggregated, and
          how.
        </Summary>
      </Documentation>

      <Using Namespace="Org.OData.Core.V1" Alias="Core" />


      <Term Name="SupportsApply" Type="Self.SupportsApplyType" AppliesTo="EntitySet EntityContainer">
        <Documentation>
          <Summary>
            This entity set or container supports the $apply system query option
          </Summary>
        </Documentation>
      </Term>

      <ComplexType Name="SupportsApplyType">
        <Documentation>
          <Summary>
            SupportsCount indicates whether the virtual property $count can be used
            in the aggregate transformation
            SupportedTransformations contains the list of transformations that can
            be used in $apply
            AggregatableProperties contains the list of property names that can
            be used in the aggregate transformation.
            GroupableProperties contains the list of property names that can be
            used in the groupby transformation.
          </Summary>
        </Documentation>
        <Property Name="SupportsCount" Type="Edm.Boolean" DefaultValue="false" />
        <Property Name="SupportedTransformations" Type="Collection(Edm.String)" Nullable="true" />
        <Property Name="AggregatableProperties" Type="Collection(Self.AggregatableProperty)" Nullable="true" />
        <Property Name="GroupableProperties" Type="Collection(Self.GroupableProperty)" Nullable="true" />
      </ComplexType>

      <ComplexType Name="AggregatableProperty">
        <Property Name="Name" Type="Edm.PropertyPath" />
        <Property Name="DefaultAggregrationFunction" Type="Edm.String" Nullable="true" />
        <Property Name="SupportedAggregrationFunctions" Type="Collection(SupportedAggregationFunction)" Nullable="true" />
        <Property Name="RequiredGroupingProperties" Type="Collection(Edm.PropertyPath)" Nullable="true" />
      </ComplexType>

      <ComplexType Name="SupportedAggregationFunction">
        <Property Name="Name" Type="Edm.String" />
        <Property Name="SupportedGroupingProperties" Type="Collection(Edm.PropertyPath)" Nullable="true" />
      </ComplexType>

      <ComplexType Name="FloatingMeasure" BaseType="Self.AggregatableProperty">
        <Property Name="Type" Type="Edm.String" />
        <Property Name="InputProperties" Type="Collection(Edm.PropertyPath)" />
      </ComplexType>


      <ComplexType Name="GroupableProperty">
        <Property Name="Name" Type="Edm.PropertyPath" />
        <Property Name="DependentProperties" Type="Collection(Edm.PropertyPath)" Nullable="true" />
      </ComplexType>

      <Term Name="Hierarchy" Type="Self.HierarchyType" AppliesTo="EntitySet EntityContainer">
        <Documentation>
          <Summary>
            This entity set or container contains hierarchical groupable properties
          </Summary>
        </Documentation>
      </Term>

      <ComplexType Name="HierarchyType" Abstract="true">
        <Property Name="Name" Type="String" Nullable="false" />
      </ComplexType>


      <ComplexType Name="LeveledHierarchy" BaseType="Self.HierarchyType">
        <!--Ordered list of properties in the hierarchy -->
        <Property Name="Levels" Type="Collection(Edm.PropertyPath)" Nullable="false" />
      </ComplexType>

      <ComplexType Name="RecursiveHierarchy" BaseType="Self.HierarchyType">
        <Property Name="NodeProperty" Type="Edm.PropertyPath" Nullable="false" />             
        <Property Name="ParentNodeProperty" Type="Edm.PropertyPath" Nullable="true" />
        <Property Name="HierarchyLevelProperty" Type="Edm.PropertyPath" Nullable="true" />
        <Property Name="IsLeafProperty" Type="Edm.PropertyPath" Nullable="true">
          <Annotation Term="Core.RequiresType" String="Edm.Boolean" />
        </Property>
      </ComplexType>

      <Term Name="AvailableOnAggregates" Type="Self.AvailableOnAggregatesType" AppliesTo="Action Function">
        <Documentation>
          <Summary>
            This Action or Function is available on aggregated entries, as long as
            the RequiredProperties are still available.
          </Summary>
        </Documentation>
      </Term>

      <ComplexType Name="AvailableOnAggregatesType">
        <Property Name="RequiredProperties" Type="Collection(Edm.PropertyPath)" Nullable="false" />
      </ComplexType>


    </Schema>
  </edmx:DataServices>
</edmx:Edmx>