<?xml version="1.0" encoding="utf-8"?>
<edmx:Edmx xmlns:edmx="http://docs.oasis-open.org/odata/ns/edmx" Version="4.0">
  <edmx:Reference Uri="http://tinyurl.com/Org-OData-Core">
    <edmx:Include Namespace="Org.OData.Core.V1" Alias="Core" />
  </edmx:Reference>

  <edmx:DataServices>
    <Schema xmlns="http://docs.oasis-open.org/odata/ns/edm" Namespace="Org.OData.Aggregation.V1" Alias="Aggregation">
      <Documentation>
        <Summary>
          The following annotations allow to describe which data in a given entity
          model can be aggregated, and how.
        </Summary>
      </Documentation>


      <Term Name="SupportsApply" Type="Aggregation.SupportsApplyType" AppliesTo="EntitySet EntityContainer">
        <Documentation>
          <Summary>
            This entity set or entity container supports the $apply system query
            option.
          </Summary>
        </Documentation>
      </Term>

      <ComplexType Name="SupportsApplyType">
        <Documentation>
          <Summary>
            SupportsCount indicates whether the virtual property $count can be used
            in the aggregate transformation.
            SupportedTransformations
            contains the list of transformations that can
            be used in $apply.
            AggregatableProperties contains the list of property names that can
            be used
            in the aggregate transformation.
            GroupableProperties contains the list of property names that can be
            used in the groupby transformation.
            SupportsMultipleRollupHierarchies indicates whether the server supports
            more than one rollup hierarchy in a groupby transformation.
          </Summary>
        </Documentation>
        <Property Name="SupportsCount" DefaultValue="true" Type="Edm.Boolean" />
        <Property Name="SupportedTransformations" Nullable="true" Type="Collection(Edm.String)" />
        <Property Name="AggregatableProperties" Nullable="true" Type="Collection(Aggregation.AggregatableProperty)" />
        <Property Name="GroupableProperties" Nullable="true" Type="Collection(Aggregation.GroupableProperty)" />
        <Property Name="SupportsMultipleRollupHierarchies" DefaultValue="true" Type="Edm.Boolean" />
      </ComplexType>


      <ComplexType Name="AggregatableProperty">
        <Property Name="Name" Type="Edm.PropertyPath" />
        <Property Name="DefaultAggregrationFunction" Type="Edm.String" Nullable="true" />
        <Property Name="SupportedAggregrationFunctions" Type="Collection(SupportedAggregationFunction)" Nullable="true" />
        <Property Name="RequiredGroupingProperties" Type="Collection(Edm.PropertyPath)" Nullable="true" />
      </ComplexType>

      <ComplexType Name="SupportedAggregationFunction">
        <Property Name="Name" Type="Edm.String" />
        <Property Name="SupportedGroupingProperties" Type="Collection(Edm.PropertyPath)" Nullable="true" />
      </ComplexType>

      <ComplexType Name="GroupableProperty">
        <Property Name="Name" Type="Edm.PropertyPath" />
        <Property Name="DependentProperties" Type="Collection(Edm.PropertyPath)" Nullable="true" />
      </ComplexType>


      <Term Name="LeveledHierarchy" Type="Aggregation.LeveledHierarchyType" AppliesTo="EntityType">
        <Documentation>
          <Summary>
            Defines a leveled hierarchy.
          </Summary>
        </Documentation>
      </Term>

      <ComplexType Name="LeveledHierarchyType">
        <!--Ordered list of properties in the hierarchy -->
        <Property Name="Levels" Type="Collection(Edm.PropertyPath)" Nullable="false" />
      </ComplexType>



      <Term Name="RecursiveHierarchy" Type="Aggregation.RecursiveHierarchyType" AppliesTo="EntityType">
        <Documentation>
          <Summary>
            Defines a recursive hierarchy.
          </Summary>
        </Documentation>
      </Term>

      <ComplexType Name="RecursiveHierarchyType">
        <Property Name="NodeProperty" Type="Edm.PropertyPath" Nullable="false" />
        <Property Name="ParentNodeProperty" Type="Edm.PropertyPath" Nullable="true" />
        <Property Name="HierarchyLevelProperty" Type="Edm.PropertyPath" Nullable="true" />
        <Property Name="IsLeafProperty" Type="Edm.PropertyPath" Nullable="true">
          <Annotation Term="Core.RequiresType" String="Edm.Boolean" />
        </Property>
      </ComplexType>


      <Term Name="AvailableOnAggregates" Type="Aggregation.AvailableOnAggregatesType" AppliesTo="Action Function">
        <Documentation>
          <Summary>
            This Action or Function is available on aggregated entities, as long as
            the RequiredProperties are still available.
          </Summary>
        </Documentation>
      </Term>

      <ComplexType Name="AvailableOnAggregatesType">
        <Property Name="RequiredProperties" Type="Collection(Edm.PropertyPath)" Nullable="false" />
      </ComplexType>

    </Schema>
  </edmx:DataServices>
</edmx:Edmx>